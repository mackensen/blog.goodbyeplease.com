<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Goodbye Please</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="canonical" href="https://blog.goodbyeplease.com/page/7/"/>
  <meta property="og:type" content="website">
<meta property="og:title" content="Goodbye Please">
<meta property="og:url" content="https://blog.goodbyeplease.com/page/7/">
<meta property="og:site_name" content="Goodbye Please">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Charles Fulton">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Goodbye Please" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Goodbye Please</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Amtrak, B-Movies, Web Development, and other nonsense</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/how-to-identify-a-train/">How to identify a train</a>
        
          <a class="main-nav-link" href="/b-movie-metric/">B-movie metric</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.goodbyeplease.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Nix-flake-with-Node-and-PHP" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/24/Nix-flake-with-Node-and-PHP/" class="article-date">
  <time class="dt-published" datetime="2023-10-25T01:43:50.000Z" itemprop="datePublished">2023-10-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/24/Nix-flake-with-Node-and-PHP/">Nix flake with Node and PHP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>Brief note on a nix flake that supports Node 20 and PHP 7.4. My use case is deploying an AWS CDK project that supports a Moodle 3.11 environment. I’m not version-limited on the Node version for CDK, but I need to start with PHP 7.4 to support the Moodle package code, though I’ll be moving to PHP 8.1 soon.</p>
<p>Here’s the flake.nix in its entirety:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  description = <span class="string">&quot;Example JavaScript development environment for Zero to Nix&quot;</span>;</span><br><span class="line"></span><br><span class="line">  # Flake inputs</span><br><span class="line">  inputs = <span class="punctuation">&#123;</span></span><br><span class="line">    nixpkgs.url = <span class="string">&quot;github:NixOS/nixpkgs?ref=nixos-unstable&quot;</span>;</span><br><span class="line">    phps.url = <span class="string">&quot;github:fossar/nix-phps&quot;</span>;</span><br><span class="line">  <span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br><span class="line">  # Flake outputs</span><br><span class="line">  outputs = <span class="punctuation">&#123;</span> self<span class="punctuation">,</span> nixpkgs<span class="punctuation">,</span> phps <span class="punctuation">&#125;</span><span class="punctuation">:</span></span><br><span class="line">    let</span><br><span class="line">      # Systems supported</span><br><span class="line">      allSystems = <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;x86_64-linux&quot;</span> # <span class="number">64</span>-bit Intel/AMD Linux</span><br><span class="line">        <span class="string">&quot;aarch64-linux&quot;</span> # <span class="number">64</span>-bit ARM Linux</span><br><span class="line">        <span class="string">&quot;x86_64-darwin&quot;</span> # <span class="number">64</span>-bit Intel macOS</span><br><span class="line">        <span class="string">&quot;aarch64-darwin&quot;</span> # <span class="number">64</span>-bit ARM macOS</span><br><span class="line">      <span class="punctuation">]</span>;</span><br><span class="line"></span><br><span class="line">      # Helper to provide system-specific attributes</span><br><span class="line">      forAllSystems = f<span class="punctuation">:</span> nixpkgs.lib.genAttrs allSystems (system<span class="punctuation">:</span> f <span class="punctuation">&#123;</span></span><br><span class="line">        pkgs = import nixpkgs <span class="punctuation">&#123;</span> inherit system; <span class="punctuation">&#125;</span>;</span><br><span class="line">      <span class="punctuation">&#125;</span>);</span><br><span class="line">    in</span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      # Development environment output</span><br><span class="line">      devShells = forAllSystems (<span class="punctuation">&#123;</span> pkgs <span class="punctuation">&#125;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        default = pkgs.mkShell <span class="punctuation">&#123;</span></span><br><span class="line">          # The Nix packages provided in the environment</span><br><span class="line">          packages = with pkgs; <span class="punctuation">[</span></span><br><span class="line">            nodejs_20 # Node.js <span class="number">18</span><span class="punctuation">,</span> plus npm<span class="punctuation">,</span> npx<span class="punctuation">,</span> and corepack</span><br><span class="line">            yarn</span><br><span class="line">            phps.packages.$<span class="punctuation">&#123;</span>system<span class="punctuation">&#125;</span>.php74</span><br><span class="line">            phps.packages.$<span class="punctuation">&#123;</span>system<span class="punctuation">&#125;</span>.php74.packages.composer</span><br><span class="line">          <span class="punctuation">]</span>;</span><br><span class="line">    </span><br><span class="line">          shellHook = &#x27;&#x27;</span><br><span class="line">            yarn</span><br><span class="line">            npx aws-cdk --version</span><br><span class="line">            php -v</span><br><span class="line">          &#x27;&#x27;;</span><br><span class="line">        <span class="punctuation">&#125;</span>;</span><br><span class="line">      <span class="punctuation">&#125;</span>);</span><br><span class="line">    <span class="punctuation">&#125;</span>;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/2023/10/24/Nix-flake-with-Node-and-PHP/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2023/10/24/Nix-flake-with-Node-and-PHP/" data-id="cm7cs8xoj007w8nmmcp52ef31" data-title="Nix flake with Node and PHP" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nix/" rel="tag">Nix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-This-blog-post-was-written-with-Hexo-and-Nix" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/22/This-blog-post-was-written-with-Hexo-and-Nix/" class="article-date">
  <time class="dt-published" datetime="2023-10-23T01:32:50.000Z" itemprop="datePublished">2023-10-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/22/This-blog-post-was-written-with-Hexo-and-Nix/">This blog post was written with Hexo and Nix</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>A few weeks ago I was at <a target="_blank" rel="noopener" href="https://events.highedweb.org/heweb23">HighEdWeb 2023</a> in Buffalo and caught a talk (“<a target="_blank" rel="noopener" href="https://events.highedweb.org/heweb23/session/1435403/maybe-some-other-time-docker-fast-declarative-and-reproducible-developer-environments-using-nix">Maybe some other time Docker: Fast, declarative and reproducible developer environments using Nix</a>”) from <a target="_blank" rel="noopener" href="https://hachyderm.io/@woodwardjd">Jason Woodward</a> about <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Nix_(package_manager)">Nix</a>. Nix is many things, including an OS, but he focused on Nix-the-package-manager and that’s what I’m going to (briefly) discuss here.</p>
<p>To grossly oversimplify, <a target="_blank" rel="noopener" href="https://zero-to-nix.com/concepts/nixpkgs">Nixpkgs</a> is a collection of tens of thousands of packages precompiled for various platforms. Each version of each package can be referenced by hash. Using a <a target="_blank" rel="noopener" href="https://zero-to-nix.com/concepts/flakes">nix flake</a>, you can specify which packages should be associated with your project. The <code>nix develop</code> command will then use path magic to load the specified packages into your shell. When you exit from the shell the paths are unloaded.</p>
<p>I moved this blog to <a target="_blank" rel="noopener" href="https://hexo.io/">hexo</a> about a year ago. My authoring environment needs a few things: a reasonable version of node, <code>hexo server</code> running in the background to serve pages, and <code>hexo generate --watch</code> to catch changes as I write. My old process involved manually kicking those processes off. Before I could do that, I had to run <code>nvm use</code> to leverage the <code>.nvmrc</code> file at the root of my project directory to ensure that I had the correct version of node active, including the global reference for hexo.</p>
        
          <p class="article-more-link">
            <a href="/2023/10/22/This-blog-post-was-written-with-Hexo-and-Nix/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2023/10/22/This-blog-post-was-written-with-Hexo-and-Nix/" data-id="cm7cs8xor00bt8nmmddxbdjy0" data-title="This blog post was written with Hexo and Nix" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NVM/" rel="tag">NVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nix/" rel="tag">Nix</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Space-Probe-Taurus" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/16/Space-Probe-Taurus/" class="article-date">
  <time class="dt-published" datetime="2023-10-17T02:20:35.000Z" itemprop="datePublished">2023-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Movies/">Movies</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/16/Space-Probe-Taurus/">Space Probe Taurus</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      <div class="poster">
        <img src="/2023/10/16/Space-Probe-Taurus/space-probe-taurus-poster.jpg">
      </div>
      
      
        <p>The vibe on <em>Space Probe Taurus</em> is weird, for lack of a more specific term. It has the bones of a typical 1950s-1960s hard science fiction near-future let’s-go-conquer-space flick. The four main characters, the only ones we spend any real time with, are stock types: the hard-driving commander, the older scientist/engineer, the tough-on-the-surface female scientist, and the wiseguy she eventually falls for. They crew a rocketship dispatched from Earth in the year 2000 to explore outer space and find a planet suitable for colonization.</p>
<p>Things start weird and get weirder. We open not with this crew, but with the last surviving member of a different rocketship. The ship is located on an undefined planet, the rest of the crew killed by an unspecified disease and/or radiation. Somehow in real-time communication with Earth (this movie’s hand-waving of time and space problems anticipates J. J. Abrams by over 40 years), he implores for Earth to destroy the ship and kill him. After some back-and-forth, Mission Control pushes a button on a panel (!) and destroys the ship.</p>
<p>On the one hand, this trope of self-sacrifice for the conquest of space was pretty common. The <em>Quatermass</em> movies were all over this territory; <a target="_blank" rel="noopener" href="https://letterboxd.com/film/first-man-into-space/"><em>First Man into Space</em></a> is another example. On the other, and this is going to be a pattern with this movie, we never really mention this crew and its sacrifice again. Our crew doesn’t travel to this planet; it’s not mentioned in dialogue. I’m not sure it’s a <em>wrong</em> choice–the planet was clearly unsuitable, no use throwing good money after bad etc–it’s just unexpected.</p>
        
          <p class="article-more-link">
            <a href="/2023/10/16/Space-Probe-Taurus/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2023/10/16/Space-Probe-Taurus/" data-id="cm7cs8xoo00aj8nmmgxen42vf" data-title="Space Probe Taurus" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Leonard-Katzman/" rel="tag">Leonard Katzman</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Space-Probe-Taurus/" rel="tag">Space Probe Taurus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/The-Wizard-of-Mars/" rel="tag">The Wizard of Mars</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/War-Gods-of-the-Deep/" rel="tag">War-Gods of the Deep</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-So-your-Google-WiFi-pucks-have-the-slows" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/10/16/So-your-Google-WiFi-pucks-have-the-slows/" class="article-date">
  <time class="dt-published" datetime="2023-10-16T18:41:28.000Z" itemprop="datePublished">2023-10-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/10/16/So-your-Google-WiFi-pucks-have-the-slows/">So your Google WiFi pucks have the slows</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>The short version of this post is that the “Preferred activities” feature in the Google Home app may have undesired results, and before tearing your hair out try turning it off to see if things improve. Read on for discussion.</p>
<h2><span id="the-problem">The problem</span></h2>
<p>I live a row house and, as it typical of row houses in the Northeast United States, it’s tall and deep, rather than wide. This always posed a problem for WiFi coverage–the router is in the front of the house where the cable comes in from the street, so by the time you reach the kitchen in the rear of the house, to say nothing of the second and third floors, the signal became weak or non-existent.</p>
        
          <p class="article-more-link">
            <a href="/2023/10/16/So-your-Google-WiFi-pucks-have-the-slows/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2023/10/16/So-your-Google-WiFi-pucks-have-the-slows/" data-id="cm7cs8xoo00a68nmmfd7h8a9s" data-title="So your Google WiFi pucks have the slows" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Google-WiFi/" rel="tag">Google WiFi</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Multiple-PHP-versions-under-the-same-domain" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/28/Multiple-PHP-versions-under-the-same-domain/" class="article-date">
  <time class="dt-published" datetime="2023-03-28T17:09:16.000Z" itemprop="datePublished">2023-03-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/28/Multiple-PHP-versions-under-the-same-domain/">Multiple PHP versions under the same domain</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>I recently had cause to run two different versions of PHP under the same top-level domain. I was able to accomplish this using Apache and PHP-FPM, leveraging Apache’s Directory directive. This builds on DigitalOcean’s excellent tutorial, “<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-run-multiple-php-versions-on-one-server-using-apache-and-php-fpm-on-ubuntu-18-04">How To Run Multiple PHP Versions on One Server Using Apache and PHP-FPM on Ubuntu 18.04</a>”, and assumes that you have done something similar to get multiple versions of PHP running using PHP-FPM.</p>
<p>In my use case, I have multiple different version of Moodle running under the same top-level domain. Each Moodle version is installed in a different directory under that domain, and has its own uploads and database. Moodle is somewhat aggressive about supported PHP versions, and I needed to have both PHP 7.4 (for Moodle 3.9) and PHP 8.0 (for Moodle 4.1) available, and each <em>cannot</em> run under the other version.</p>
<p>The solution is to add an <a target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/mod/core.html#directory">Directory</a> override for the site that needs the lower version of PHP, while leaving the higher version as the default case:</p>
        
          <p class="article-more-link">
            <a href="/2023/03/28/Multiple-PHP-versions-under-the-same-domain/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2023/03/28/Multiple-PHP-versions-under-the-same-domain/" data-id="cm7cs8xoi007j8nmmexxw9arj" data-title="Multiple PHP versions under the same domain" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache/" rel="tag">Apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP-FPM/" rel="tag">PHP-FPM</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Browser-Headers-and-WordPress" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/14/Browser-Headers-and-WordPress/" class="article-date">
  <time class="dt-published" datetime="2023-03-15T02:39:13.000Z" itemprop="datePublished">2023-03-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/14/Browser-Headers-and-WordPress/">Browser Headers and WordPress</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>We’ve been running WordPress using Cloudfront as a full-site front-end cache with a low TTL and it’s been great overall, but one pain point has been which headers to whitelist in the origin configuration. This is pretty important: origin behavior governs what data Cloudfront passes back to the actual containers (or EC2 instances, it doesn’t matter in this case) serving your WordPress site. Omitting the wrong headers can have some fairly drastic consequences, like rich-text editors not displaying or REST API calls failing. This post takes Cloudfront as its example, but this would be relevant with any solution where you’re defining an allowlist of headers instead of just passing everything.</p>
<h2><span id="behaviors">Behaviors</span></h2>
<p>Before tackling headers, let me say a few words about <em>behaviors</em> in Cloudfront. Carl Alexander does a great job on this in <a target="_blank" rel="noopener" href="https://blog.ymirapp.com/wordpress-page-caching-cloudfront/">How to use CloudFront to do WordPress page caching</a>. For each behavior in Cloudfront you can define a different origin (e.g. Fargate containers, an S3 bucket, a Lambda function), which HTTP methods to allow, which headers to allow, what the caching policy should be. You differentiate behaviors by path. In a WordPress install, that means you could define different behaviors for each of the following paths:</p>
        
          <p class="article-more-link">
            <a href="/2023/03/14/Browser-Headers-and-WordPress/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2023/03/14/Browser-Headers-and-WordPress/" data-id="cm7cs8xo7002s8nmmg3m5gsw0" data-title="Browser Headers and WordPress" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloudfront/" rel="tag">Cloudfront</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WordPress/" rel="tag">WordPress</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Proxying-Cloudfront-with-Nginx" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/29/Proxying-Cloudfront-with-Nginx/" class="article-date">
  <time class="dt-published" datetime="2022-11-30T00:28:42.000Z" itemprop="datePublished">2022-11-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/29/Proxying-Cloudfront-with-Nginx/">Proxying Cloudfront with Nginx</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>Don’t do this.</p>
<p>You’re still here? Cool, let’s continue. For complicated reasons involving a legacy on-premises application I had a static site on AWS that I needed to route to with an Nginx reverse proxy. The application architecture included several locations, each of which was proxied to a different port on an on-premises server. The <em>landing page</em>, and only the landing page (and its assets), are on Cloudfront. For historical reasons, I needed to have this entire collection under a single DNS name.</p>
<h2><span id="location-location">Location, location …</span></h2>
        
          <p class="article-more-link">
            <a href="/2022/11/29/Proxying-Cloudfront-with-Nginx/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2022/11/29/Proxying-Cloudfront-with-Nginx/" data-id="cm7cs8xol008y8nmm62eo82wk" data-title="Proxying Cloudfront with Nginx" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloudfront/" rel="tag">Cloudfront</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-EFS-mount-watchdog-and-CPU-usage" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/23/EFS-mount-watchdog-and-CPU-usage/" class="article-date">
  <time class="dt-published" datetime="2022-11-23T21:22:23.000Z" itemprop="datePublished">2022-11-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/23/EFS-mount-watchdog-and-CPU-usage/">EFS mount watchdog and CPU usage</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>The moral of today’s story is that there is a direct relationship between the number of EFS mounts on an EC2 instance and the resting level of CPU usage.</p>
<p>We ship our Fargate deployments with a bastion host if they contain an EFS filesystem and/or an RDS cluster. This takes the form of an EC2 autoscaling group. As we only need the bastion host for time-limited tasks, we keep the desired capacity at 0 by default and raise to 1 as needed. We use the scaling policies to ensure that the instance is turned down after a period of inactivity:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bastionCPUThreshold = opts.<span class="property">cpuThreshold</span> ?? <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> bastionScalingPeriod = opts.<span class="property">scalingPeriod</span> ?? <span class="title class_">Duration</span>.<span class="title function_">minutes</span>(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CPUUtilizationMetric</span> = <span class="keyword">new</span> <span class="title class_">Metric</span>(&#123;</span><br><span class="line">  <span class="attr">namespace</span>: <span class="string">&#x27;AWS/EC2&#x27;</span>,</span><br><span class="line">  <span class="attr">metricName</span>: <span class="string">&#x27;CPUUtilization&#x27;</span>,</span><br><span class="line">  <span class="attr">dimensionsMap</span>: &#123;</span><br><span class="line">  <span class="title class_">AutoScalingGroupName</span>: <span class="variable language_">this</span>.<span class="property">autoScalingGroup</span>.<span class="property">autoScalingGroupName</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">period</span>: bastionScalingPeriod,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scalingPolicy = <span class="variable language_">this</span>.<span class="property">autoScalingGroup</span>.<span class="title function_">scaleOnMetric</span>(<span class="string">&#x27;ScaleToCPU&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">metric</span>: <span class="title class_">CPUUtilizationMetric</span>,</span><br><span class="line">  <span class="attr">scalingSteps</span>: [</span><br><span class="line">  &#123; <span class="attr">upper</span>: bastionCPUThreshold, <span class="attr">change</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">lower</span>: bastionCPUThreshold, <span class="attr">change</span>: <span class="number">1</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">adjustmentType</span>: <span class="title class_">AdjustmentType</span>.<span class="property">EXACT_CAPACITY</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/2022/11/23/EFS-mount-watchdog-and-CPU-usage/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2022/11/23/EFS-mount-watchdog-and-CPU-usage/" data-id="cm7cs8xoa003w8nmmg1jngh9z" data-title="EFS mount watchdog and CPU usage" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/" rel="tag">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CDK/" rel="tag">CDK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/EFS/" rel="tag">EFS</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Customizing-the-CDK-bootstrap-stack" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/22/Customizing-the-CDK-bootstrap-stack/" class="article-date">
  <time class="dt-published" datetime="2022-11-22T05:00:00.000Z" itemprop="datePublished">2022-11-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/22/Customizing-the-CDK-bootstrap-stack/">Customizing the CDK bootstrap stack</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>Amazon’s CDK creates a helper Cloudformation stack (by default named <code>CDKToolkit</code>) with a few resources to assist with deployment. The most familiar to regular users are the S3 asset bucket and the ECR repository.</p>
<p>A source of mild frustration for my colleagues and me is that this default stack doesn’t set lifecycle policies on either, which then trips up Amazon’s security controls (<a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#s3-10-remediation">S3 10</a> and <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#ecr%E2%80%943-remediation">ECR 3</a>, respectively).</p>
<p>Fortunately, there is a relatively straightforward solution, and that’s customizing the Cloudformation template that manages the CDKToolkit stack. I hadn’t realized before now that you can do this but it’s <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping.html">well-documented</a>. First, use <code>cdk bootstrap</code> to output the contents of the template. You’ll want to ensure that you’re using the same version of CDK that you’ll use to deploy the stack:</p>
        
          <p class="article-more-link">
            <a href="/2022/11/22/Customizing-the-CDK-bootstrap-stack/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2022/11/22/Customizing-the-CDK-bootstrap-stack/" data-id="cm7cs8xo800378nmm9ml17pas" data-title="Customizing the CDK bootstrap stack" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/" rel="tag">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CDK/" rel="tag">CDK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloudformation/" rel="tag">Cloudformation</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-Moodle-TypeScript-and-CDK" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/11/21/Moodle-TypeScript-and-CDK/" class="article-date">
  <time class="dt-published" datetime="2022-11-21T18:25:02.000Z" itemprop="datePublished">2022-11-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web-Development/">Web Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/11/21/Moodle-TypeScript-and-CDK/">Moodle, TypeScript, and CDK</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <p>We moved our Moodle workloads to AWS in 2020, using CDK to manage the infrastructure. It’s one of our oldest such deployments and has been stable for years. I was nonplussed, to say the least, when, I attempted to update our development environment to the Moodle 4.1 beta and received almost 400 TypeScript errors like the one below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public/lib/editor/tiny/js/tinymce/tinymce.d.ts(7,10): error TS2304: Cannot find name <span class="string">&#x27;Range&#x27;</span>.</span><br></pre></td></tr></table></figure>
<p>It took me a few minutes to realize what I was actually looking at. We install the Moodle core code in the <code>public</code> directory of the project. CDK’s <code>npm run build</code> command wraps <code>tsc</code>, the typescript compiler, and it was looking at TypeScript modules inside the Moodle directory. Thanks to a helpful hint from <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/41465954/exclude-folder-when-compiling-typescript">Stackoverflow</a>, I modified <code>tsconfig.json</code> to exclude <code>public</code>:</p>
        
          <p class="article-more-link">
            <a href="/2022/11/21/Moodle-TypeScript-and-CDK/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.goodbyeplease.com/2022/11/21/Moodle-TypeScript-and-CDK/" data-id="cm7cs8xoh007b8nmmg70x3swd" data-title="Moodle, TypeScript, and CDK" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/" rel="tag">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CDK/" rel="tag">CDK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Moodle/" rel="tag">Moodle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Football/">Football</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/History/">History</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Humor/">Humor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Movies/">Movies</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Music/">Music</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Outdoors/">Outdoors</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Trains/">Trains</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Travel/">Travel</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web-Development/">Web Development</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/12/06/Mileage-problems-on-the-Long-Island-Rail-Road/">Mileage problems on the Long Island Rail Road</a>
          </li>
        
          <li>
            <a href="/2024/12/06/Pushing-to-GitHub-over-443/">Pushing to GitHub over 443</a>
          </li>
        
          <li>
            <a href="/2024/11/19/Packaging-a-Lambda-with-Nodejs-20-and-AWS-SDK-for-JavaScript-v2/">Packaging a Lambda with Nodejs 20 and AWS SDK for JavaScript v2</a>
          </li>
        
          <li>
            <a href="/2024/11/13/Devenv-python-and-packaging-Lambdas/">Devenv, python, and packaging Lambdas</a>
          </li>
        
          <li>
            <a href="/2024/11/10/A-visit-to-the-Bridgeview/">A visit to the Bridgeview</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Charles Fulton <a rel="me noopener" target="_blank" href="https://higheredweb.social/@mackensen">Find me on Mastodon</a><br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/how-to-identify-a-train/" class="mobile-nav-link">How to identify a train</a>
  
    <a href="/b-movie-metric/" class="mobile-nav-link">B-movie metric</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>